<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Búsqueda</title>
</head>
<body>
    <h1>Resultados de Búsqueda para el Socio {{ numero_socio }}</h1>
    {% if movimientos %}
        <table border="1">
            <tr>
                <th>Apellido y Nombre</th>
                <th>Fecha</th>
                <th>Concepto</th>
                <th>Monto</th>
            </tr>
            {% set movimientos_agrupados = {} %}
            {% for movimiento in movimientos %}
                {% set fecha_actual = movimiento.get('fecha', '') %}
                {% if not movimientos_agrupados[fecha_actual] %}
                    {% set _ = movimientos_agrupados.update({fecha_actual: []}) %}
                {% endif %}
                {% set _ = movimientos_agrupados[fecha_actual].append(movimiento) %}
            {% endfor %}
            {% for fecha, movimientos_fecha in movimientos_agrupados.items() %}
                <tr style="background-color: lightgray;">
                    <td colspan="4"><strong>{{ fecha }}</strong></td>
                </tr>
                {% for movimiento in movimientos_fecha %}
                    <tr>
                        <td>{{ movimiento.get('apellidoNombre', '') }}</td>
                        <td>{{ fecha }}</td>
                        <td>{{ movimiento.get('concepto', '') }}</td>
                        <td>{{ movimiento.get('monto', '') }}</td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </table>
    {% else %}
        <p>No se encontraron movimientos para el Socio {{ numero_socio }}.</p>
    {% endif %}
</body>
</html>
