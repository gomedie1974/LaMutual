<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO -->
    <title>Mutual LN Asociarse</title>
    <meta name="keywords" content="mutual">
    <meta name="description" content="Asociacion mutual del personal de La Nacion">
        
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- pone el logo en la pestana -->
    <link rel="shortcut icon" href="../image/Logo Asociacion Mutual.JPG">
    <title>CSS</title>
    <link rel="stylesheet" href="../style/style.css">
    
    <!-- Bootstrap core CSS -->
    <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">   
     <!-- Custom styles for this template -->
     <link href="headers.css" rel="stylesheet">
 
    <title>Buscar por Número de Socio</title>
     <style>
         .bd-placeholder-img {
          font-size: 1.125rem;
          text-anchor: middle;
          -webkit-user-select: none;
          -moz-user-select: none;
          user-select: none;
        }
  
        @media (min-width: 768px) {
          .bd-placeholder-img-lg {
            font-size: 3.5rem;
          }
        }
        /* Alineo algunos campos */
    th:nth-child(3), td:nth-child(3) {
        text-align: center;
        }
    th:nth-child(4), td:nth-child(4) {
        text-align: center;
        }
    th:nth-child(5), td:nth-child(5) {
        text-align: center;
        }
    th:nth-child(6), td:nth-child(6) {
        text-align: center;
        }
    
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th {
            position: sticky;
            top: 0;
            background-color: #f2f2f2;  
        }
        table, th, td {
            border: 1px solid black;
        }
        #volverContainer {
            text-align: right;
            margin-top: 10px;
            margin-right: 20px;
        }
        .subtotal-row {
         color: rgb(166, 0, 0);
         font-style: italic;
        }
        .info-box {
          background-color: rgb(244, 249, 208);
            float: right; /* Alinea el cuadro a la derecha */
            width: 350px; /* Ajusta el ancho según tus necesidades */
            padding: 1px;
            border: 1px solid #800404;
            border-radius: 5px;
            margin-left: 20px; /* Espacio entre el título y el cuadro */
            margin-right: 10px;
            box-sizing: border-box; /* Incluye el padding y border en el ancho y alto */
            margin-top: -40px; /* Ajusta este valor para subir o bajar el cuadro */
        }
                /* Media query para hacer el cuadro responsive */
        @media (max-width: 767px) {
            .info-box {
                float: none; /* Desactiva la alineación a la derecha */
                width: 90%; /* Ocupa todo el ancho disponible */
                /* margin-left: 0; */ /* Elimina el margen izquierdo */
                margin-top: 10px; /* Ajusta el espacio entre el título y el cuadro */
            }
        }
        .total-general {
          color: #000000; /* Cambia este color al que prefieras */
          font-weight: bold; /* Otras propiedades de estilo si lo deseas */
       }

      
    </style>
</head>
<body >
    <nav class="navbar navbar-dark   bg-secondary">    
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Cuenta Corriente</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <li class="nav-item">
                  <hr class="bg-light">
                  <li class="nav-item dropdown ">
                    <a class="nav-link dropdown-toggle text-white" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Descuentos</a>
                  <ul class="dropdown-menu"> 
                  <li><a href="../pages/almacen.html" class="nav-link px-2 text-white bg-secondary">Almacen</a></li>    
                  <li><a href="../pages/aperitivos.html" class="nav-link px-2 text-white bg-secondary">Bebidas</a></li>    
                  <li><a href="../pages/canjes.html" class="nav-link px-2 text-white bg-secondary">Canjes</a></li>
                  <li><a href="../pages/feria.html" class="nav-link px-2 text-white bg-secondary">Feria</a></li>  
                  <li><a href="../pages/hogar.html" class="nav-link px-2 text-white bg-secondary">Hogar</a></li>
                  <li><a href="../pages/juegos.html" class="nav-link px-2 text-white bg-secondary">Juegos</a></li>
                  <li><a href="../pages/puravida.html" class="nav-link px-2 text-white bg-secondary">Pura Vida</a></li>
                    </ul> 
                  </li>
                  
                    <a class="nav-link active" aria-current="page" href="../pages/ayudaeconomica.html">Ayuda Económica</a>
                    <a class="nav-link active" aria-current="page" href="../pages/colecciones.html">Colecciones LN</a>
                    <a class="nav-link active" aria-current="page" href="../pages/productos.html">Productos</a>
                    <a class="nav-link active" aria-current="page" href="../pages/subsidios.html">Subsidios</a>
                    <a class="nav-link active" aria-current="page" href="../pages/asociarse.html">Asociarse</a>
                    <a class="nav-link active" aria-current="page" href="../pages/contacto.html">Contacto</a>
                    <hr class="bg-light">
                    <a class="nav-link active" aria-current="page" href="../index.html">Home</a>
                  </li>
              </li>
            </ul> 
          </div>
        </div>
      </nav>
      <br> 
      <div>
        <p style="text-align: center; color: rgb(0, 0, 0); font-size: 130%; font-family: prumo;"><b><u>ESTADO DE CUENTA CORRIENTE</u></b></p>
        <p style="text-align: center">Última actualización: <strong>09/12/2023 09:50 hs</strong></p>
        <!-- Agrega el cuadro de información al lado derecho del título -->
        <div class="info-box">
            <span>Pago por transferencia </span> <br><button id="infocbu" class="btn btn-primary btn-sm">CBU</button><br>
            <span ><b><u>Fechas de pago</u></b> <br>ADHERENTES y JUBILADOS<strong><br> 1 al 8 de cada mes</strong></span>
        </div><br>
    </div>
    
<div class="mt-4 m-2" > 
<!-- Agrega dos nuevos campos de entrada para el apellido y nombre -->
<label for="numeroSocioInput">Número de Socio:</label>
<input type="text" id="numeroSocioInput">

<label for="apellidoNombreInput">Apellido y Nombre/s:</label>
<input type="text" id="apellidoNombreInput">

<button class="btn btn-primary" onclick="buscarPorNumeroSocio()">Buscar</button>
<div id="mensaje" style="color: red;"><b>Por favor, complete ambos campos: Número de Socio y Apellido y Nombre/s completos.</b></div>

    </div>
    <hr>
    <div class="m-2 ">
    <table id="tablaResultados" >
        <thead>
            <tr>
                <th>Apellido y Nombre</th>
                <th>Concepto</th>
                <th>Fecha</th>
                <th >Monto</th>
                <th>Cuota</th>
                <th>Cbte.</th>
                
                <!-- <th>Socio</th> -->
            </tr>
        </thead>
        <tbody id="resultados"></tbody>
        <tfoot id="subtotalesMensuales">
            <!-- Aquí se agregarán los subtotales mensuales dinámicamente -->
        </tfoot>
        <tfoot>
            <tr>
                <td colspan="2"></td>
                <td><strong>Total General</strong></td>
                <td id="totalGeneral" class="total-general"></td>
                <td></td>
            </tr>
        </tfoot>
    </table>
</div>
    <script>
      //informacion CBU
      const boton1 = document.getElementById("infocbu");
      boton1.addEventListener("click", infocbu);
      function infocbu() {
              Swal.fire({
                  imageUrl: '../image/CBU.png',
                  imageWidth: 400,
                  imageHeight: 200,
                  })   
                }

/*     function convertirFormatoCuota(cuota) {
    // Mapea los nombres de los meses a sus números correspondientes
    const meses = {
        'ene': '1',
        'feb': '2',
        'mar': '3',
        'abr': '4',
        'may': '5',
        'jun': '6',
        'jul': '7',
        'ago': '8',
        'sep': '9',
        'oct': '10',
        'nov': '11',
        'dic': '12'
    };

    // Divide la cuota en partes
    var cuotaParts = cuota.split("-");
    var numeroCuota = cuotaParts[0];
    var mesCuota = cuotaParts[1];

    // Obtén el número del mes utilizando el mapeo
    var numeroMes = meses[mesCuota];

    // Formatea la cuota como "1/1" en lugar de "1/ene"
    var formatoCuota = numeroCuota + "/" + numeroMes;
    return formatoCuota;
}

 */function buscarPorNumeroSocio() {
    var numeroSocioBuscado = document.getElementById("numeroSocioInput").value;
    var apellidoNombreBuscado = document.getElementById("apellidoNombreInput").value;
    var mensajeDiv = document.getElementById("mensaje");
     
    // Verifica que los campos obligatorios estén llenos
    if (!numeroSocioBuscado || !apellidoNombreBuscado) {
        // Muestra el mensaje de error
        mensajeDiv.textContent = "Por favor, complete ambos campos: Número de Socio y Apellido y Nombre.";
        return;
    }
        // Verifico que el campo Apellido y Nombre tenga al menos 6 caracteres
        if (apellidoNombreBuscado.length < 9) {
        // Muestra el mensaje de error
        mensajeDiv.textContent = "Datos incompletos";
        return;
    }


    // Limpia el mensaje si los campos están llenos
    mensajeDiv.textContent = "";

    var resultadosTbody = document.getElementById("resultados");
    var subtotalesMensualesTfoot = document.getElementById("subtotalesMensuales");
    var totalGeneralCell = document.getElementById("totalGeneral");
    resultadosTbody.innerHTML = ""; // Limpia resultados anteriores
    subtotalesMensualesTfoot.innerHTML = ""; // Limpia subtotales mensuales anteriores
    totalGeneralCell.textContent = ""; // Limpia el total general anterior


    // Carga el archivo JSON con fetch
    fetch('datos.json')
        .then(response => response.json())
        .then(data => {
            // Accedo a la propiedad "movimientos" del objeto JSON
            var movimientos = data.movimientos;
            var totalGeneral = 0;

            // Objeto para almacenar subtotales por mes
            var subtotalesMensuales = {};
            var mesActual = null;

            movimientos.forEach(function (movimiento) {
/*               movimiento.cuota = convertirFormatoCuota(movimiento.cuota);
 */
                // Verifica si coincide el número de socio o el apellido y nombre
                if (
                    movimiento.numeroSocio == numeroSocioBuscado && 
                    movimiento.apellidoNombre.toLowerCase().includes(apellidoNombreBuscado.toLowerCase()/* .substring(0, 2) */)
                    
                ) { /* con el substring hago que coincidan por lo menos las 2 letras */
                    // Calcular el total general
                    totalGeneral += parseFloat(movimiento.monto.replace("$", "").replace(",", ""));

                    // Calcular el total mensual
                    var fechaParts = movimiento.fecha.split("-");
                    var mesMovimiento = fechaParts[0].toLowerCase();

                    // Inicializar el subtotal para el mes si es la primera vez
                    if (!subtotalesMensuales[mesMovimiento]) {
                        subtotalesMensuales[mesMovimiento] = 0;
                    }

                    // Verificar si hay un cambio de mes
                    if (mesActual !== null && mesActual !== mesMovimiento) {
                        // Agregar una fila de subtotal
                        var subtotalRow = resultadosTbody.insertRow();
                        subtotalRow.classList.add("subtotal-row"); // Agrega la clase a la fila de subtotal

                        subtotalRow.innerHTML = `<td colspan="2"></td><td>${mesActual.toUpperCase()} - Subtotal</td><td>$ ${subtotalesMensuales[mesActual].toFixed(2)}</td><td></td>`;

                        // Reiniciar el subtotal para el nuevo mes
                        subtotalesMensuales[mesMovimiento] = 0;
                    }

                    // Acumular el monto al subtotal del mes
                    subtotalesMensuales[mesMovimiento] += parseFloat(movimiento.monto.replace("$", "").replace(",", ""));

                    // Agregar una fila a la tabla por cada resultado
                    var fila = resultadosTbody.insertRow();

                    // Agregar celdas a la fila
                    var celdaApellidoNombre = fila.insertCell(0);
                    var celdaConcepto = fila.insertCell(1);
                    var celdaFecha = fila.insertCell(2);
                    var celdaMonto = fila.insertCell(3);
                    var celdaCuota = fila.insertCell(4);
                    var celdaDetalle = fila.insertCell(5);
                    
                    var celdaNumeroSocio = fila.insertCell(6);

                    // Llenar las celdas con la información del movimiento
                    celdaApellidoNombre.textContent = movimiento.apellidoNombre;
                    celdaConcepto.textContent = movimiento.concepto;
                    celdaFecha.textContent = movimiento.fecha;
                    celdaCuota.textContent = movimiento.cuota;
                    celdaMonto.textContent = `$ ${movimiento.monto}`;
                    celdaDetalle.textContent = movimiento.detalle;


                    // Actualizar el mes actual
                    mesActual = mesMovimiento;
                }
            });
            
            // Agregar la última fila de subtotal
            if (mesActual !== null) {
                var ultimoSubtotalRow = resultadosTbody.insertRow();
                ultimoSubtotalRow.innerHTML = `<td colspan="2";></td><td>${mesActual.toUpperCase()} - Subtotal</td><td>${subtotalesMensuales[mesActual].toFixed(2)}</td><td></td>`;
            }

            // Mostrar el total general en la tabla
            //totalGeneralCell.textContent = `$ ${totalGeneral.toFixed(2)}`;
            totalGeneralCell.textContent = formatNumber(totalGeneral);
            function formatNumber(number) {
                return number.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
               // return number.toFixed(2).replace(/\./g, ',').replace(/\d(?=(\d{3})+,)/g, '$&.');

            }



            console.log(JSON.stringify(data, null, 2));

        })
        .catch(error => console.error('Error al cargar el archivo JSON:', error));
}
    </script>

<footer class="mt-4 pt-4">
    <br><br>
     <hr> 
    <section class="grid-footer" > 
      <div >
        <h5><img src="../image/localizacion.png" alt="mapa" srcset="" width="120"></h5>
        <p>
          Av. del Libertador 101 - PB<br>
          Torre al Río - Vte. López
          </p>
      </div>
      <div>
        <h5><img src="../image/te.jpg" alt="mapa" srcset="" width="50"></h5>
        <p>L a V 9.00 a 19.00 hs<br>
          6090-5147 / 5033 
        </p>
      </div>
      <div>
        <h5><a href="mailto:mutual@lanacion.com.ar"><img src="../image/mail.png" alt="mapa" srcset="" width="50"></a></h5>
        <p>mutual@lanacion.com.ar
          </p>
      </div>
      <div>
        <h5><a href="https://www.instagram.com/lnmutual/" target="_blank"><img src="../image/instagram.jfif" alt="mapa" srcset="" width="40"></a></h5>
        <p>@lnmutual
          </p>
      </div>
     
      </section>
   
</footer>
<div class="m-2">
    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3286.7792704454764!2d-58.46981028627339!3d-34.53381988047762!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95bcb6a6413ab341%3A0x3bcb7f994f576a0c!2sAv.%20del%20Libertador%20101%2C%20B1638BEK%20Vicente%20L%C3%B3pez%2C%20Provincia%20de%20Buenos%20Aires!5e0!3m2!1sen!2sar!4v1659731461935!5m2!1sen!2sar" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
</div>


  <!-- JAVA -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>